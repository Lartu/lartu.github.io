<head>
	<title>Lartu.net</title>
	<link rel="stylesheet" href="styles.css">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/png" href="images/images/fuyukogif2.png" />
	<meta name="description" content="">
	<link rel='alternate' type='application/rss+xml' title='RSS Feed' href='files/rss.xml.rss'/>
</head>
<table style="border-collapse: collapse;">
    <tr>
        <td style="vertical-align: middle">
            <div style="display: block; width: 50px;">
            <img src ="images/fuyuko2.gif" class="logo">
            </div>
        </td>
        <td style="vertical-align: bottom">
            lartunet
            — <a href="index.html"  >home</a>
            — <a href="computing.html"  >computing</a>
            : <a href="gamesart.html"  >games & art</a>
            : <a href="research.html"  >research</a>
            — <a href="sitemap.html"  >sitemap</a>
        </td>
    </tr>
</table>

<h1>Mitsubachi</h1>

<p><img src ="images/W18N70.png" title="W18N70" alt="Image: W18N70"></p>

<p>Mitsubachi is a tiny and open chat protocol, designed to be minimal, easy to implement, easy to use and easy to understand. Mitsubachi supports nicknames, nickname changing, user-to-user messaging and channel / group (known in Mitsubachi as "distribution lists") chat.</p>

{{p

I designed the Mitsubachi protocol because I found that most common, open chat
protocols (IRC, XMPP, etc.) are to complex too implement properly and
completely. Writing a very bare-bones IRC client is easy, but implementing the
whole protocol is not. XMPP messages are way to heavy to be reliable on
high-latency, low-bandwidth networks. The protocol is also very complex for an
amateur, casual client / server writer to implement. Mitsubachi aims to address
all these issues.

<h2>protocol tl;dr</h2>

<p>Connection is done via plain sockets on TCP port 7107.</p>

<p>Messages between client and server are divided in 5 sections separated by a single space.</p>

<p>Messages end with a \n character.</p>

<p><table border="1"> <tr> <th colspan=5>Mitsubachi Message Format</th> </tr> <tr> <td>Command</td> <td>Sender</td> <td>Recipient</td> <td>Extra-Data</td> <td>Content</td> </tr> <tr> <td>4 chars</td> <td>1 to 32 chars</td> <td>1 to 32 chars</td> <td>&gt;1 chars</td> <td>&gt;1 chars</td> </tr> </table></p>

<p>All clients and lists have a nick that identifies them. Nicks are unique.</p>

<p>Lists also have nicks, but list nicks begin with the character !.</p>

<p>Clients may join and leave lists. Messages sent to a client are delivered to that client. Messages sent to lists are sent to every client on that list.</p>

<p>When a client joins a list that doesn't exist, it is created and the client is added to it.</p>

<p>Below is a list of valid commands. These commands can both be sent to a Mitsubachi server or be received by a Mitsubachi client: <table border="1"> <tr> <th>Command</th> <th>Action</th> </tr> <tr> <td><code>NICK &lt;nick&gt; # # #\n</code></td> <td>Used to change your nick</td> </tr> <tr> <td><code>JOIN # &lt;list-nick&gt; # #\n</code></td> <td>Used to join a list</td> </tr> <tr> <td><code>LEAV # &lt;list-nick&gt; # #\n</code></td> <td>Used to leave a list</td> </tr> <tr> <td><code>MESG &lt;sender-nick&gt; &lt;recipient-nick&gt; # &lt;message&gt;\n</code></td> <td>Used to send an actual message to a nick</td> </tr> <tr> <td><code>EXIT # # # #\n</code></td> <td>Used to close the connection, usually sent by clients only</td> </tr> <tr> <td><code>OOPS # # &lt;error-code&gt; #\n</code></td> <td>Used to tell a client the result of an operation (sent by servers)</td> </tr> <tr> <td><code>INFO # # # &lt;error-code&gt;\n</code></td> <td>Used by servers to send text messages to clients</td> </tr> </table> Notice in the table above how every command has the five sections stated in the previous table. <code>#</code> means the literal character #. This character (or any other character really, as it should be ignored) is used to fulfill the character requirement of at least one character of unused sections.</p>

<p><b>Error codes:</b> A server should reply <i>000</i> ("ok") when a client changes their nick successfully. Otherwise it should reply <i>001</i> ("nick already in use") or <i>002</i> ("invalid nick", for nicks beginning in ! for users). <i>003</i> should be sent when trying to join an invalid list (using a client nick). <i>005</i> should be sent when a client tries to send a message to a list they are not a member of. <i>006</i> should be sent when an invalid command is received by the server. <i>007</i> should be sent to clients that have not chosen a nick when the server has received a command from them other than NICK.</p>

<h2>protocol details</h2>

<p>By default and standard, Mitsubachi servers listen for connections on TCP port 7107. Clients (users) connect to a server by plain socket connection.</p>

<p>Exchange between server and client is handled via messages. A message is a string sent from a client to the server or from the server to a client. Messages have a maximum length of 1024 bytes (1024 characters), are divided in 5 sections and follow the format:</p>

<p><code>command sender recipient extradata content\n</code></p>

<p>Note the \n at the end. This character is used to delimit the end of the message and thus cannot be used anywhere else in the message.</p>

<p>Each section of a message represents a different type of information:</p>

<ul>
<li> The <b>command</b> part tells the recipent of the message what we intend to do with this message (for example, change our nick or join a list). <ul> <li> This section has a fixed length of 4 characters. <li> This section is always UPPERCASE.</li> </ul> <li> The <b>sender</b> part tells the recipient who is this message from. <ul> <li> This section has a minimum length of 1 character. <li> This section has a maximum length of 32 characters. <li> This section is always lowercase. <li> This section may not contain any spaces.</li> </ul> <li> The <b>recipient</b> part tells who was this message sent to. <ul> <li> This section has a minimum length of 1 character. <li> This section has a maximum length of 32 characters. <li> This section is always lowercase. <li> This section may not contain any spaces.</li> </ul> <li> The <b>extradata</b> section is a reserved part of the message used for sending error codes or other data. <ul> <li> This section has a minimum length of 1 character. <li> This section has no maximum length. <li> This section is always lowercase. <li> Multiple words in this section must be delimited by the character <code>|</code>. <li> This section may not contain any spaces.</li> </ul> <li> The <b>content</b> part of the message is used for sending messages per sé, as in the content of a message (<i>"hi there!"</i>, <i>"how are you?"</i>). <ul> <li> This section has a minimum length of 1 character. <li> This section has no maximum length. <li> This section may contain spaces.</li> </ul></li>
</ul>

<p>When a section is supposed to be empty (for example, when sending a message to the server that has no recipient) it must be filled with a single character, usually <code>#</code>.</p>

<p>The minimum length of any message is 13: <code>XXXX # # # #\n</code>.</p>

<p><b>Nicks</b> identify users. Each user has a nick (or nickname) and no two users can have the same nickname. When a user disconnects from the server, their nickname becomes available to be used by other user. Nicknames have a minimum length of 1 character and a maximum length of 32 characters. Nicknames that start with the character <code>!</code> identify lists. As such, user nicknames cannot contain this character in the first position. Nicks can contain any character except spaces.</p>

<p><b>Lists</b> are lists of users. They have a nickname just like any other user, but messages sent to a list are sent to every member of the list. In order to be able to send a message to a list, a client must be part of said list (otherwise error message <i>005</i> ("you are not a member of this list") should be sent to the client). When a message is sent to a list, it is broadcast to every member of the list except the one who sent the message. Users may join and leave lists at any time. When a client tries to join a non-existant list, it is created.</p>

<p>All this said, the following messages are valid Mitsubachi messages:</p>

<ul>
<li> <b>NICK</b>: sent by a client to a server to change their nick. If the nick is in use by another client, the server should reply <code>OOPS # # 001 #\n</code> ("nick already in use"). It the nick is available to be used, the server should reply <code>OOPS # # 000 #\n</code> ("ok") and assign the nick to the client. <ul> <li> Command section value: NICK <li> Sender section value: the desired nick <li> Recipient section value: # <li> Extradata section value: # <li> Content section value: # <li> Example: <code>NICK myNick # # #\n</code></li> </ul></li>
</ul>

<ul>
<li> <b>JOIN</b>: sent by a client to a server to join a list. If the nick of the list to be joined is not a valid list nick, the server should reply <code>OOPS # # 003 #\n</code> ("invalid distribution list"). If the list is valid, the client should be joined to the list and the server should reply <code>OOPS # # 000 #\n</code> ("ok"). <ul> <li> Command section value: JOIN <li> Sender section value: # <li> Recipient section value: nick of the list to be joined <li> Extradata section value: # <li> Content section value: # <li> Example: <code>JOIN # !mitsubachi # #\n</code></li> </ul></li>
</ul>

<ul>
<li> <b>LEAV</b>: sent by a client to a server to leave a list. If the nick of the list to be left is not a valid list nick, the server should reply <code>OOPS # # 003 #\n</code> ("invalid distribution list"). If the list is valid, the client should be removed from the list and the server should reply <code>OOPS # # 000 #\n</code> ("ok"). <ul> <li> Command section value: LEAV <li> Sender section value: # <li> Recipient section value: nick of the list to be left <li> Extradata section value: # <li> Content section value: # <li> Example: <code>LEAV # !lamelist # #\</code></li> </ul></li>
</ul>

<ul>
<li> <b>MESG</b>: sent by a client to a server to deliver a message to another client or list. When this message is sent by the server to a client it means that said client has received a message. <ul> <li> Command section value: MESG <li> Sender section value: nick of the sender of the message <li> When a client is the one that sends this message to a server, it may omit the contents of this section and just send a # in it instead. When this message is sent by a server to a client, the content of this section is always the nick of the user who sent the message originally. <li> Recipient section value: nick of the recipient of the message (user or list) <li> Extradata section value: # <li> Content section value: actual contents of the message <li> Example: <code>MESG user1 coolUser # Hello there, coolUser, how are you?\n</code></li> </ul></li>
</ul>

<ul>
<li> <b>EXIT</b>: sent by a client to a server to close the connection. <ul> <li> Command section value: EXIT <li> Sender section value: # <li> Recipient section value: # <li> Extradata section value: # <li> Content section value: # <li> Example: <code>EXIT # # # #\n</code></li> </ul></li>
</ul>

<ul>
<li> <b>OOPS</b>: sent by a server to a client to inform the result of the requested operation. This message shouldn't be sent by clients. <ul> <li> Command section value: OOPS <li> Sender section value: # <li> Recipient section value: # <li> Extradata section value: error code that represents the result of the requested operation <li> Content section value: # <li> Example: <code>OOPS # # 000 #\n</code></li> </ul></li>
</ul>

<ul>
<li> <b>INFO</b>: an information message from the server with a text message. This is supposed to be read by the user. It may contain a MOTD or any valuable information the server administrator desires to send clients. <ul> <li> Command section value: INFO <li> Sender section value: # <li> Recipient section value: # <li> Extradata section value: # <li> Content section value: the contents of a message <li> Example: <code>INFO # # # Welcome to Mitsubachi!\n</code></li> </ul></li>
</ul>

<p>In order to request any command to a server, clients must first have chosen a nick (by issuing a NICK message). Should they try to send any other message to the server other than a NICK command, the server should reply <code>OOPS # # 007 #\n</code> ("please log in").</p>

<p>Should a message not in the list above be received by a server, it should reply <code>OOPS # # 006 #\n</code> ("unknown command").</p>

<h2>implementations</h2>

<p>A Mitsubachi Server written in <a href="https://ldpl-lang.org" class=external target=_blank>LDPL</a> is uploaded <a href="https://github.com/Lartu/mitsubachi/blob/master/mitsubachi-server.ldpl" class=external target=_blank>here</a>. You are allowed to use and modify it in any way you see fit. You are encouraged to host your own Mitsubachi servers! In order to build and run this server implementation you must run the following commands:</p>

<p><pre>ldpl mitsubachi-server.ldpl -o=mitsubachi-server</pre></p>

<p>This server implementation requires the <a href="https://github.com/Lartu/ldpl-net-server/" class=external target=_blank>LDPL Net Server</a> and the text package from the <a href="https://github.com/Lartu/ldpl-std" class=external target=_blank>LDPL Standard Library</a>.</p>

<p>If at the time of reading the LDPL Library Library is still available, you can install both libraries by running:</p>

<p><pre>lpm install ldpl_net_server lpm install std-text</pre></p>

<h2>license</h2>

<p>The Mitsubachi protocol is released under the MIT license and may be freely reproduced and translated. The Mitsubachi bee logo is released under the MIT license and may be freely reproduced on any medium.</p>
<br>
<br>
<br>

<a href="https://twitter.com/martulartu" class=external target=_blank><img src ="images/btn_twitter.png" class="mediabutton"></a>
<a href="https://github.com/lartu" class=external target=_blank><img src ="images/btn_git.png" class="mediabutton"></a>
<a href="https://lartu.itch.io/" class=external target=_blank><img src ="images/btn_itch.png" class="mediabutton"></a>
<a href="https://lartu.net/files/rss.xml.rss" class=external target=_blank><img src ="images/btn_rss.png" class="mediabutton"></a>

<br>

<small><b>Lartu</b> © 2015 - 2021 — Released under the
<a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" class=external target=_blank>Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported</a>
License.
</small>